version: 2.1

jobs:
  x64-test:
    docker:
      - image: silkeh/clang:16
    steps:
      - checkout
      - run:
          name: 'Setup bazelisk'
          command: |
            curl -SL -o /tmp/bazel \
              https://github.com/bazelbuild/bazelisk/releases/download/v1.17.0/bazelisk-linux-amd64
            sudo mv /tmp/bazel /usr/local/bin/bazel
            sudo chmod +x /usr/local/bin/bazel
      - run:
          name: "Run tests"
          command: |
            clang --version
            bazel test --config=ci //...

workflows:
  wasmcc:
    jobs:
      - x64-test
